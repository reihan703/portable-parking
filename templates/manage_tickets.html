{% extends 'base.html' %} {% block content %}
<form class="mb-5 px-4">
	<div class="form-row row align-middle">
		<div class="col-2 mr-2">
			<input
				type="text"
				class="form-control mr-sm-2"
				id="ticketInput"
				name="ticketInput"
				placeholder="Masukkan Kode Tiket"
			/>
		</div>
		<div class="col-2 d-flex justify-content-between">
			<button type="submit" class="btn btn-outline-primary w-50 mx-2">
				Cari
			</button>
			<button
				type="button"
				class="btn btn-outline-secondary w-50 mx-2"
				id="scanButton"
			>
				Pindai
			</button>
		</div>
	</div>
</form>

<p id="scanResult" class="mt-2"></p>

<div class="px-4">
	<table class="table">
		<thead class="thead-light text-center align-middle">
			<tr>
				<th scope="col">ID Tiket</th>
				<th scope="col">Kode Kendaraan</th>
				<th scope="col">Tanggal Terbuat</th>
				<th scope="col">Tanggal Selesai</th>
				<th scope="col">Status</th>
				<th scope="col"></th>
			</tr>
		</thead>
		<tbody class="text-center">
			<tr>
				<th scope="row">1</th>
				<td>Mark</td>
				<td>Otto</td>
				<td>@mdo</td>
				<td>100</td>
				<td>
					<div class="btn-group">
						<a
							type="button"
							class="btn btn-outline-warning dropdown-toggle"
							data-bs-toggle="dropdown"
							aria-expanded="false"
						>
							Sunting
							<i class="fa-solid fa-pencil"></i>
						</a>
						<ul class="dropdown-menu">
							<!-- Dropdown menu links -->
							<li>
								<a class="dropdown-item" href="#"
									>Ubah Kode Kendaraan</a
								>
							</li>
							<li>
								<a class="dropdown-item" href="#"
									>Tutup Transaksi</a
								>
							</li>
						</ul>
					</div>
				</td>
			</tr>
		</tbody>
	</table>
</div>

<div class="container px-5 d-flex justify-content-center">
	<img
		src="static/assets/image.png"
		class="img-fluid"
		width="75%"
		height="75%"
		alt="image"
	/>
</div>

<script>
	document
		.getElementById("scanButton")
		.addEventListener("click", function (event) {
			event.preventDefault();

			fetch('{{ url_for("scan_ticket") }}', {
				method: "POST",
				headers: {
					"Content-Type": "application/json",
				},
			})
				.then((response) => {
					if (!response.ok) {
						throw new Error(
							"Network response was not ok " + response.statusText
						);
					}
					return response.json();
				})
				.then((data) => {
					if (data.scanned_ticket) {
						document.getElementById("ticketInput").value =
							data.scanned_ticket;
						document.getElementById(
							"scanResult"
						).innerText = `QR Code Scanned: ${data.scanned_ticket}`;
					} else {
						console.error("No scanned ticket in response:", data);
					}
				})
				.catch((error) => {
					console.error("Error:", error);
				});
		});
</script>
{% endblock %}
